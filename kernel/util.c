#include "hardware.h"
#include "segmentation.h"
#include "sched.h"
#include "interrupt.h"
#include "memory.h"

int fonts[128][8] = {
{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{}
,{
0b00111000,
0b00111000,
0b00111000,
0b00010000,
0b00000000,
0b00111000,
0b00111000,
0b00000000
}
,{}
,{
0b00101000,
0b00101000,
0b11111110,
0b00101000,
0b11111110,
0b00101000,
0b00101000,
0b00000000
}
,{
0b01111100,
0b10010010,
0b10010000,
0b01111100,
0b00010010,
0b10010010,
0b01111100,
0b00000000
}
,{
0b11100010,
0b10100100,
0b11101000,
0b00010000,
0b00101110,
0b01001010,
0b10001110,
0b00000000
}
,{
0b00110000,
0b01001000,
0b00110000,
0b01110000,
0b10001010,
0b10000100,
0b01111010,
0b00000000
}
,{
0b00111000,
0b00111000,
0b00010000,
0b00100000,
0b00000000,
0b00000000,
0b00000000,
0b00000000
}
,{
0b00011000,
0b00100000,
0b01000000,
0b01000000,
0b01000000,
0b00100000,
0b00011000,
0b00000000
}
,{
0b00110000,
0b00001000,
0b00000100,
0b00000100,
0b00000100,
0b00001000,
0b00110000,
0b00000000
}
,{
0b00000000,
0b01000100,
0b00101000,
0b11101110,
0b00101000,
0b01000100,
0b00000000,
0b00000000
}
,{
0b00000000,
0b00010000,
0b00010000,
0b01111100,
0b00010000,
0b00010000,
0b00000000,
0b00000000
}
,{
0b00000000,
0b00000000,
0b00000000,
0b00111000,
0b00111000,
0b00010000,
0b00100000,
0b00000000
}
,{
0b00000000,
0b00000000,
0b00000000,
0b01111100,
0b00000000,
0b00000000,
0b00000000,
0b00000000
}
,{
0b00000000,
0b00000000,
0b00000000,
0b00000000,
0b00111000,
0b00111000,
0b00111000,
0b00000000
}
,{
0b00000010,
0b00000100,
0b00001000,
0b00010000,
0b00100000,
0b01000000,
0b10000000,
0b00000000
}
,{
0b00111000,
0b01000100,
0b10100010,
0b10010010,
0b10001010,
0b01000100,
0b00111000,
0b00000000
}
,{
0b00010000,
0b00110000,
0b01010000,
0b00010000,
0b00010000,
0b00010000,
0b01111100,
0b00000000
}
,{
0b01111100,
0b10000010,
0b00000010,
0b01111100,
0b10000000,
0b10000000,
0b11111110,
0b00000000
}
,{
0b01111100,
0b10000010,
0b00000010,
0b01111100,
0b00000010,
0b10000010,
0b01111100,
0b00000000
}
,{
0b10000000,
0b10000100,
0b10000100,
0b11111110,
0b00000100,
0b00000100,
0b00000100,
0b00000000
}
,{
0b11111110,
0b10000000,
0b10000000,
0b01111100,
0b00000010,
0b10000010,
0b01111100,
0b00000000
}
,{
0b01111100,
0b10000010,
0b10000000,
0b11111100,
0b10000010,
0b10000010,
0b01111100,
0b00000000
}
,{
0b11111110,
0b10000100,
0b00001000,
0b00010000,
0b00100000,
0b00100000,
0b00100000,
0b00000000
}
,{
0b01111100,
0b10000010,
0b10000010,
0b01111100,
0b10000010,
0b10000010,
0b01111100,
0b00000000
}
,{
0b01111100,
0b10000010,
0b10000010,
0b01111110,
0b00000010,
0b10000010,
0b01111100,
0b00000000
}
,{
0b00010000,
0b00101000,
0b00010000,
0b00000000,
0b00010000,
0b00101000,
0b00010000,
0b00000000
}
,{
0b00111000,
0b00111000,
0b00000000,
0b00111000,
0b00111000,
0b00010000,
0b00100000,
0b00000000
}
,{
0b00001000,
0b00010000,
0b00100000,
0b01000000,
0b00100000,
0b00010000,
0b00001000,
0b00000000
}
,{
0b00000000,
0b00000000,
0b01111100,
0b00000000,
0b01111100,
0b00000000,
0b00000000,
0b00000000
}
,{
0b00100000,
0b00010000,
0b00001000,
0b00000100,
0b00001000,
0b00010000,
0b00100000,
0b00000000
}
,{
0b01111100,
0b10000010,
0b00000010,
0b00001100,
0b00010000,
0b00000000,
0b00010000,
0b00000000
}
,{
0b01111100,
0b10000010,
0b10111010,
0b10101010,
0b10111100,
0b10000010,
0b01111100,
0b00000000
}
,{
0b00010000,
0b00101000,
0b01000100,
0b10000010,
0b11111110,
0b10000010,
0b10000010,
0b00000000
}
,{
0b11111100,
0b10000010,
0b10000010,
0b11111100,
0b10000010,
0b10000010,
0b11111100,
0b00000000
}
,{
0b01111100,
0b10000010,
0b10000000,
0b10000000,
0b10000000,
0b10000010,
0b01111100,
0b00000000
}
,{
0b11111100,
0b10000010,
0b10000010,
0b10000010,
0b10000010,
0b10000010,
0b11111100,
0b00000000
}
,{
0b11111110,
0b10000000,
0b10000000,
0b11111000,
0b10000000,
0b10000000,
0b11111110,
0b00000000
}
,{
0b11111110,
0b10000000,
0b10000000,
0b11111000,
0b10000000,
0b10000000,
0b10000000,
0b00000000
}
,{
0b01111100,
0b10000010,
0b10000000,
0b10011110,
0b10000010,
0b10000010,
0b01111100,
0b00000000
}
,{
0b10000010,
0b10000010,
0b10000010,
0b11111110,
0b10000010,
0b10000010,
0b10000010,
0b00000000
}
,{
0b00111000,
0b00010000,
0b00010000,
0b00010000,
0b00010000,
0b00010000,
0b00111000,
0b00000000
}
,{
0b00000010,
0b00000010,
0b00000010,
0b00000010,
0b10000010,
0b10000010,
0b01111100,
0b00000000
}
,{
0b10000100,
0b10001000,
0b10010000,
0b11100000,
0b10010000,
0b10001000,
0b10000100,
0b00000000
}
,{
0b10000000,
0b10000000,
0b10000000,
0b10000000,
0b10000000,
0b10000000,
0b11111110,
0b00000000
}
,{
0b10000010,
0b11000110,
0b10101010,
0b10010010,
0b10000010,
0b10000010,
0b10000010,
0b00000000
}
,{
0b10000010,
0b11000010,
0b10100010,
0b10010010,
0b10001010,
0b10000110,
0b10000010,
0b00000000
}
,{
0b11111110,
0b10000010,
0b10000010,
0b10000010,
0b10000010,
0b10000010,
0b11111110,
0b00000000
}
,{
0b11111100,
0b10000010,
0b10000010,
0b11111100,
0b10000000,
0b10000000,
0b10000000,
0b00000000
}
,{
0b01111100,
0b10000010,
0b10000010,
0b10000010,
0b10001010,
0b10000100,
0b01111010,
0b00000000
}
,{
0b11111100,
0b10000010,
0b10000010,
0b11111100,
0b10001000,
0b10000100,
0b10000010,
0b00000000
}
,{
0b01111100,
0b10000010,
0b10000000,
0b01111100,
0b00000010,
0b10000010,
0b01111100,
0b00000000
}
,{
0b11111110,
0b00010000,
0b00010000,
0b00010000,
0b00010000,
0b00010000,
0b00010000,
0b00000000
}
,{
0b10000010,
0b10000010,
0b10000010,
0b10000010,
0b10000010,
0b10000010,
0b01111100,
0b00000000
}
,{
0b10000010,
0b10000010,
0b10000010,
0b10000010,
0b01000100,
0b00101000,
0b00010000,
0b00000000
}
,{
0b10000010,
0b10010010,
0b10010010,
0b10010010,
0b10010010,
0b10010010,
0b01101100,
0b00000000
}
,{
0b10000010,
0b01000100,
0b00101000,
0b00010000,
0b00101000,
0b01000100,
0b10000010,
0b00000000
}
,{
0b10000010,
0b01000100,
0b00101000,
0b00010000,
0b00010000,
0b00010000,
0b00010000,
0b00000000
}
,{
0b11111110,
0b00000100,
0b00001000,
0b00010000,
0b00100000,
0b01000000,
0b11111110,
0b00000000
}
,{
0b01111100,
0b01000000,
0b01000000,
0b01000000,
0b01000000,
0b01000000,
0b01111100,
0b00000000
}
,{}
,{
0b01111100,
0b00000100,
0b00000100,
0b00000100,
0b00000100,
0b00000100,
0b01111100,
0b00000000
}
,{
0b00010000,
0b00101000,
0b01000100,
0b00000000,
0b00000000,
0b00000000,
0b00000000,
0b00000000
}
,{
0b00000000,
0b00000000,
0b00000000,
0b00000000,
0b00000000,
0b00000000,
0b11111110,
0b00000000
}
,{}
,{
0b00000000,
0b00011000,
0b00100100,
0b01000010,
0b01111110,
0b01000010,
0b01000010,
0b00000000
}
,{
0b00000000,
0b01111100,
0b01000010,
0b01111100,
0b01000010,
0b01000010,
0b01111100,
0b00000000
}
,{
0b00000000,
0b00111100,
0b01000010,
0b01000000,
0b01000000,
0b01000010,
0b00111100,
0b00000000
}
,{
0b00000000,
0b01111100,
0b01000010,
0b01000010,
0b01000010,
0b01000010,
0b01111100,
0b00000000
}
,{
0b00000000,
0b01111110,
0b01000000,
0b01111100,
0b01000000,
0b01000000,
0b01111110,
0b00000000
}
,{
0b00000000,
0b01111110,
0b01000000,
0b01111100,
0b01000000,
0b01000000,
0b01000000,
0b00000000
}
,{
0b00000000,
0b00111100,
0b01000010,
0b01000000,
0b01001110,
0b01000010,
0b00111100,
0b00000000
}
,{
0b00000000,
0b01000010,
0b01000010,
0b01111110,
0b01000010,
0b01000010,
0b01000010,
0b00000000
}
,{
0b00000000,
0b00001000,
0b00001000,
0b00001000,
0b00001000,
0b00001000,
0b00001000,
0b00000000
}
,{
0b00000000,
0b00000010,
0b00000010,
0b00000010,
0b00000010,
0b01000010,
0b00111100,
0b00000000
}
,{
0b00000000,
0b01000010,
0b01000100,
0b01111000,
0b01001000,
0b01000100,
0b01000010,
0b00000000
}
,{
0b00000000,
0b01000000,
0b01000000,
0b01000000,
0b01000000,
0b01000000,
0b01111110,
0b00000000
}
,{
0b00000000,
0b01000010,
0b01100110,
0b01011010,
0b01000010,
0b01000010,
0b01000010,
0b00000000
}
,{
0b00000000,
0b01000010,
0b01100010,
0b01010010,
0b01001010,
0b01000110,
0b01000010,
0b00000000
}
,{
0b00000000,
0b00111100,
0b01000010,
0b01000010,
0b01000010,
0b01000010,
0b00111100,
0b00000000
}
,{
0b00000000,
0b01111100,
0b01000010,
0b01000010,
0b01111100,
0b01000000,
0b01000000,
0b00000000
}
,{
0b00000000,
0b00111100,
0b01000010,
0b01000010,
0b01001010,
0b01000100,
0b00111010,
0b00000000
}
,{
0b00000000,
0b01111100,
0b01000010,
0b01000010,
0b01111100,
0b01000100,
0b01000010,
0b00000000
}
,{
0b00000000,
0b00111100,
0b01000000,
0b00111100,
0b00000010,
0b01000010,
0b00111100,
0b00000000
}
,{
0b00000000,
0b00111110,
0b00001000,
0b00001000,
0b00001000,
0b00001000,
0b00001000,
0b00000000
}
,{
0b00000000,
0b01000010,
0b01000010,
0b01000010,
0b01000010,
0b01000010,
0b00111100,
0b00000000
}
,{
0b00000000,
0b01000010,
0b01000010,
0b01000010,
0b01000010,
0b00100100,
0b00011000,
0b00000000
}
,{
0b00000000,
0b01000010,
0b01000010,
0b01000010,
0b01011010,
0b01100110,
0b01000010,
0b00000000
}
,{
0b00000000,
0b01000010,
0b00100100,
0b00011000,
0b00011000,
0b00100100,
0b01000010,
0b00000000
}
,{
0b00000000,
0b00100010,
0b00010100,
0b00001000,
0b00001000,
0b00001000,
0b00001000,
0b00000000
}
,{
0b00000000,
0b01111110,
0b00000100,
0b00001000,
0b00010000,
0b00100000,
0b01111110,
0b00000000
}
,{
0b00111000,
0b01000000,
0b01000000,
0b11000000,
0b01000000,
0b01000000,
0b00111000,
0b00000000
}
,{
0b00010000,
0b00010000,
0b00010000,
0b00000000,
0b00010000,
0b00010000,
0b00010000,
0b00000000
}
,{
0b00111000,
0b00000100,
0b00000100,
0b00000110,
0b00000100,
0b00000100,
0b00111000,
0b00000000
}
,{
0b01100000,
0b10010010,
0b00001100,
0b00000000,
0b00000000,
0b00000000,
0b00000000,
0b00000000
}
,{
0b10101010,
0b01010100,
0b10101010,
0b01010100,
0b10101010,
0b01010100,
0b10101010,
0b00000000
}
};

static struct HardwareInfo my_hardware_info;
static unsigned int fb_y;
static unsigned int fb_x;
static int base;

void init_frame_buffer(struct HardwareInfo *_hardware_info) {
	my_hardware_info = *_hardware_info;
	//base = hardware_info.fb.base + 0;
	fb_y = 0;
	fb_x = 0;
	//hardware_info  = *_hardware_info;
	 for (unsigned int i = 0; i < hardware_info.fb.height; i++) {
	    for (unsigned int j = 0; j < hardware_info.fb.width; j++) {
		      struct Pixel *pixel = hardware_info.fb.base + hardware_info.fb.width * i + j;
		      // † AYAME †
		      pixel->r = 111;
		      pixel->g = 51;
		      pixel->b = 129;
	    }
	  }
}

void putc(char c) {
	for (unsigned int k = 0; k < 8; k++) {
         for (unsigned int m = 0; m < 8; m++) {
                 if (((fonts[(int)c][k] >> (8-m)) & 1) == 1) {
                         //struct Pixel *pixel = hardware_info.fb.base + hardware_info.fb.width * k + m;
	// base = hardware_info.fb.base + 0;
                         //struct Pixel *pixel =  (my_hardware_info->fb).width * (k + fb_y) + m + fb_x;
                         struct Pixel *pixel = my_hardware_info.fb.base +  my_hardware_info.fb.width * (k + fb_y) + m + fb_x;
                         pixel->r = 255;
                         pixel->g = 255;
                         pixel->b = 255;
                 }
         }
  }
	 fb_x = fb_x + 8;
}

void puts(char *str) {
	int i = 0;
	while (1) {
		if (str[i] == 0) break;
		if (str[i] == '\n') {
			fb_x = 0;
			fb_y = fb_y + 8;
			i++;
			continue;
		}
		putc(str[i]);
		i++;
	}
}

int pow16(int p) {
	int result = 1;
	for (int i = 0; i < p; i++) {
		result = result * 16;
	}
	return result;
}

void puth(unsigned long long value, unsigned char digits_len) {
	int result[digits_len];
	int t = value;
	for (int i=digits_len; 0 < i; i--) {
		int tmp = pow16(i -1);
		int tmp2 = t / tmp;
		result[digits_len - i] = tmp2;
		t = t - tmp2 * tmp;
	}
	for (int j = 0; j < digits_len; j++) {
		if (result[j] == 0) putc('0');
		else if (result[j] == 1) putc('1');
		else if (result[j] == 2) putc('2');
		else if (result[j] == 3) putc('3');
		else if (result[j] == 4) putc('4');
		else if (result[j] == 5) putc('5');
		else if (result[j] == 6) putc('6');
		else if (result[j] == 7) putc('7');
		else if (result[j] == 9) putc('9');
		else if (result[j] == 10) putc('a');
		else if (result[j] == 11) putc('b');
		else if (result[j] == 12) putc('c');
		else if (result[j] == 13) putc('d');
		else if (result[j] == 14) putc('e');
		else if (result[j] == 15) putc('f');
	}
}
